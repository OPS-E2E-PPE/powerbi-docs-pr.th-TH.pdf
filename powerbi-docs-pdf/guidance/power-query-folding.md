---
title: คำแนะนำการพับคิวรีใน Power BI Desktop
description: คำแนะนำสำหรับการบรรลุการพับคิวรีใน Power Query ใน Power BI Desktop
author: peter-myers
ms.author: v-pemyer
ms.reviewer: asaxton
ms.service: powerbi
ms.subservice: powerbi
ms.topic: conceptual
ms.date: 11/09/2019
ms.openlocfilehash: 5e2ec32f3eeaff224256f0a84d2a5c23d3e882a5
ms.sourcegitcommit: 653e18d7041d3dd1cf7a38010372366975a98eae
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 12/01/2020
ms.locfileid: "96419325"
---
# <a name="query-folding-guidance-in-power-bi-desktop"></a><span data-ttu-id="6cbc5-103">คำแนะนำการพับคิวรีใน Power BI Desktop</span><span class="sxs-lookup"><span data-stu-id="6cbc5-103">Query folding guidance in Power BI Desktop</span></span>

<span data-ttu-id="6cbc5-104">บทความนี้มีเป้าหมายให้ผู้สร้างแบบจำลองข้อมูลทำการพัฒนาแบบจำลองใน Power BI Desktop</span><span class="sxs-lookup"><span data-stu-id="6cbc5-104">This article targets data modelers developing models in Power BI Desktop.</span></span> <span data-ttu-id="6cbc5-105">ซึ่งจะให้คำแนะนำแนวทางปฏิบัติเกี่ยวกับช่วงเวลาและวิธีการที่จะทำการพับคิวรีใน Power Query</span><span class="sxs-lookup"><span data-stu-id="6cbc5-105">It provides best practice guidance on when—and how—you can achieve Power Query query folding.</span></span>

<span data-ttu-id="6cbc5-106">_การพับคิวรี_ คือความสามารถสำหรับคิวรี Power Query เพื่อสร้างคำสั่งคิวรีเดียวในการดึงและแปลงข้อมูลต้นทาง</span><span class="sxs-lookup"><span data-stu-id="6cbc5-106">_Query folding_ is the ability for a Power Query query to generate a single query statement that retrieves and transforms source data.</span></span> <span data-ttu-id="6cbc5-107">สำหรับข้อมูลเพิ่มเติม ศึกษา [การพับคิวรีใน Power Query](/power-query/power-query-folding)</span><span class="sxs-lookup"><span data-stu-id="6cbc5-107">For more information, see [Power Query query folding](/power-query/power-query-folding).</span></span>

## <a name="guidance"></a><span data-ttu-id="6cbc5-108">คำแนะนำ</span><span class="sxs-lookup"><span data-stu-id="6cbc5-108">Guidance</span></span>

<span data-ttu-id="6cbc5-109">คำแนะนำการพับคิวรีที่แตกต่างกันขึ้นอยู่กับโหมดแบบจำลอง</span><span class="sxs-lookup"><span data-stu-id="6cbc5-109">Query folding guidance differs based on the model mode.</span></span>

<span data-ttu-id="6cbc5-110">ในระยะสั้น สำหรับตารางโหมดที่เก็บข้อมูล **DirectQuery** หรือ **Dual** คิวรี Power Query จะต้องทำการพับคิวรีได้</span><span class="sxs-lookup"><span data-stu-id="6cbc5-110">For a **DirectQuery** or **Dual** storage mode table, the Power Query query must achieve query folding.</span></span>

<span data-ttu-id="6cbc5-111">สำหรับตาราง **นำเข้า** อาจเป็นไปได้เพื่อให้สามารถทำการพับคิวรีได้</span><span class="sxs-lookup"><span data-stu-id="6cbc5-111">For an **Import** table, it may be possible to achieve query folding.</span></span> <span data-ttu-id="6cbc5-112">เมื่อคิวรีที่ยึดตามแหล่งข้อมูลเชิงสัมพันธ์และเมื่อสามารถสร้างคำสั่ง SELECT แบบเดียว _ประสิทธิภาพการรีเฟรชข้อมูลที่ดีที่สุด_ จะเกิดขึ้นได้โดยต้องทำให้แน่ใจว่าการพับคิวรีจะเกิดขึ้น</span><span class="sxs-lookup"><span data-stu-id="6cbc5-112">When the query is based on a relational source—and if a single SELECT statement can be constructed—you achieve _best data refresh performance_ by ensuring that query folding occurs.</span></span> <span data-ttu-id="6cbc5-113">ถ้ากลไกจัดการผสมเข้าด้วยกัน Power Query ยังคงจำเป็นในการประมวลผลการแปลงข้อมูล คุณควรพยายามลดการทำงานที่กลไกจำเป็นต้องทำ โดยเฉพาะอย่างยิ่งสำหรับชุดข้อมูลขนาดใหญ่</span><span class="sxs-lookup"><span data-stu-id="6cbc5-113">If the Power Query mashup engine is still required to process transformations, you should strive to minimize the work it needs to do, especially for large datasets.</span></span>

<span data-ttu-id="6cbc5-114">รายการหัวข้อย่อยต่อไปนี้แสดงแนวทางปฏิบัติเฉพาะ</span><span class="sxs-lookup"><span data-stu-id="6cbc5-114">The following bulleted-list provides specific guidance.</span></span>

- <span data-ttu-id="6cbc5-115">**กำหนดการประมวลผลสำหรับแหล่งข้อมูลให้มากที่สุดเท่าที่เป็นไปได้:** เมื่อไม่สามารถพับขั้นตอนทั้งหมดของคิวรี Power Query ได้ ให้ค้นหาขั้นตอนที่ขัดขวางมิให้มีการพับคิวรี</span><span class="sxs-lookup"><span data-stu-id="6cbc5-115">**Delegate as much processing to the data source as possible**: When all steps of a Power Query query can't be folded, discover the step that prevents query folding.</span></span> <span data-ttu-id="6cbc5-116">เมื่อเป็นไปได้ ให้ย้ายขั้นตอนที่ตามมาก่อนหน้านี้ตามลำดับ ซึ่งอาจเป็นปัจจัยที่ทำให้สามารถทำการพับคิวรีได้</span><span class="sxs-lookup"><span data-stu-id="6cbc5-116">When possible, move later steps earlier in sequence so they may be factored into the query folding.</span></span> <span data-ttu-id="6cbc5-117">กลไกการผสมเข้าด้วยกันของ Power Query อาจมีความชาญฉลาดพอที่จะเรียงลำดับขั้นตอนคิวรีของคุณใหม่เมื่อมีการสร้างคิวรีแหล่งข้อมูล</span><span class="sxs-lookup"><span data-stu-id="6cbc5-117">Note the Power Query mashup engine may be smart enough to reorder your query steps when it generates the source query.</span></span>

    <span data-ttu-id="6cbc5-118">สำหรับแหล่งข้อมูลเชิงสัมพันธ์ ถ้าขั้นตอนที่ขัดขวางไม่ให้สามารถทำการพับคิวรีได้ในคำสั่ง SELECT เดียวหรือภายในตรรกะเชิงกระบวนงานของ Stored Procedure ให้พิจารณาการใช้คำสั่ง SQL คิวรีแบบดั้งเดิมตามที่อธิบายไว้ในขั้นตอนถัดไป</span><span class="sxs-lookup"><span data-stu-id="6cbc5-118">For a relational data source, if the step that prevents query folding could be achieved in a single SELECT statement—or within the procedural logic of a stored procedure—consider using a native SQL query, as described next.</span></span>

- <span data-ttu-id="6cbc5-119">**ใช้คิวรี SQL แบบดั้งเดิม**: เมื่อคิวรี Power Query ดึงข้อมูลจากแหล่งข้อมูลเชิงสัมพันธ์ คุณสามารถใช้คิวรี SQL แบบดั้งเดิมได้สำหรับบางแหล่ง</span><span class="sxs-lookup"><span data-stu-id="6cbc5-119">**Use a native SQL query**: When a Power Query query retrieves data from a relational source, it's possible for some sources to use a native SQL query.</span></span> <span data-ttu-id="6cbc5-120">ในความเป็นจริง คิวรีอาจเป็นคำสั่งที่ถูกต้อง รวมถึงการดำเนินการของ Stored Procedure</span><span class="sxs-lookup"><span data-stu-id="6cbc5-120">The query can in fact be any valid statement, including a stored procedure execution.</span></span> <span data-ttu-id="6cbc5-121">ถ้าคำสั่งสร้างชุดผลลัพธ์หลายรายการ จะมีการส่งกลับค่าแรกเท่านั้น</span><span class="sxs-lookup"><span data-stu-id="6cbc5-121">If the statement produces multiple result sets, only the first will be returned.</span></span> <span data-ttu-id="6cbc5-122">สามารถประกาศพารามิเตอร์ได้ในคำสั่ง และเราแนะนำให้คุณใช้ฟังก์ชัน M ของ [Value.NativeQuery](/powerquery-m/value-nativequery)</span><span class="sxs-lookup"><span data-stu-id="6cbc5-122">Parameters can be declared in the statement, and we recommend that you use the [Value.NativeQuery](/powerquery-m/value-nativequery) M function.</span></span> <span data-ttu-id="6cbc5-123">ฟังก์ชันนี้ได้รับการออกแบบมาเพื่อให้สามารถส่งผ่านค่าพารามิเตอร์ได้อย่างปลอดภัยและสะดวก</span><span class="sxs-lookup"><span data-stu-id="6cbc5-123">This function was designed to safely and conveniently pass parameter values.</span></span> <span data-ttu-id="6cbc5-124">สิ่งสำคัญคือต้องทำความเข้าใจว่ากลไกผสมเข้าด้วยกันของ Power Query ไม่สามารถพับขั้นตอนคิวรีที่ตามมาได้ และดังนั้นจึงเป็นสิ่งสำคัญที่ต้องรวมตรรกะการแปลงข้อมูลทั้งหมด หรือเป็นจำนวนมาก ในคำสั่งคิวรีในระบบของฐานข้อมูล</span><span class="sxs-lookup"><span data-stu-id="6cbc5-124">It's important to understand that the Power Query mashup engine can't fold later query steps, and so you should include all—or as much—transformation logic in the native query statement.</span></span>

    <span data-ttu-id="6cbc5-125">มีข้อควรพิจารณาที่สำคัญสองประการที่ต้องคำนึงถึงเมื่อใช้คิวรี SQL แบบดั้งเดิม:</span><span class="sxs-lookup"><span data-stu-id="6cbc5-125">There are two important considerations you need to bear in mind when using native SQL queries:</span></span>

    - <span data-ttu-id="6cbc5-126">สำหรับตารางแบบจำลอง DirectQuery คิวรีต้องเป็นคำสั่ง SELECT และไม่สามารถใช้นิพจน์ตารางทั่วไป (CTEs) หรือ Stored Procedure</span><span class="sxs-lookup"><span data-stu-id="6cbc5-126">For a DirectQuery model table, the query must be a SELECT statement, and it can't use Common Table Expressions (CTEs) or a stored procedure.</span></span>
    - <span data-ttu-id="6cbc5-127">การรีเฟรชแบบเพิ่มหน่วยไม่สามารถใช้แบบสอบถาม SQL แบบดั้งเดิมได้</span><span class="sxs-lookup"><span data-stu-id="6cbc5-127">Incremental refresh can't use a native SQL query.</span></span> <span data-ttu-id="6cbc5-128">จากนั้นกลไกจัดการผสมเข้าด้วยกันของ Power Query จะต้องดึงข้อมูลแถวต้นทางทั้งหมด แล้วใช้ตัวกรองเพื่อกำหนดการเปลี่ยนแปลงแบบเพิ่มหน่วย</span><span class="sxs-lookup"><span data-stu-id="6cbc5-128">So, it would force the Power Query mashup engine to retrieve all source rows, and then apply filters to determine incremental changes.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="6cbc5-129">คิวรี SQL ในระบบของฐานข้อมูลสามารถทำได้มากกว่าการดึงข้อมูล</span><span class="sxs-lookup"><span data-stu-id="6cbc5-129">A native SQL query can potentially do more than retrieve data.</span></span> <span data-ttu-id="6cbc5-130">คำสั่งที่ถูกต้องใด ๆ ที่สามารถดำเนินการได้ (และอาจมีหลายครั้ง) รวมถึงคำสั่งที่ปรับเปลี่ยนหรือลบข้อมูล</span><span class="sxs-lookup"><span data-stu-id="6cbc5-130">Any valid statement can be executed (and possibly multiple times), including one that modifies or deletes data.</span></span> <span data-ttu-id="6cbc5-131">สิ่งสำคัญคือต้องใช้หลักการของสิทธิ์พิเศษน้อยที่สุด เพื่อให้แน่ใจว่าบัญชีที่ใช้ในการเข้าถึงฐานข้อมูลมีสิทธิ์ในการอ่านเฉพาะข้อมูลที่จำเป็นเท่านั้น</span><span class="sxs-lookup"><span data-stu-id="6cbc5-131">It's important that you apply the principle of least privilege to ensure that the account used to access the database has only read permission on required data.</span></span>

- <span data-ttu-id="6cbc5-132">**จัดเตรียมและแปลงข้อมูลในแหล่งข้อมูล:** เมื่อคุณระบุว่าไม่สามารถพับขั้นตอนคิวรี Power Query ได้ อาจเป็นไปได้ที่จะใช้การแปลงข้อมูลในแหล่งข้อมูล</span><span class="sxs-lookup"><span data-stu-id="6cbc5-132">**Prepare and transformation data in the source**: When you identify that certain Power Query query steps can't be folded, it may be possible to apply the transformations in the data source.</span></span> <span data-ttu-id="6cbc5-133">การแปลงสามารถทำได้โดยการเขียนมุมมองฐานข้อมูลที่มีการแปลงข้อมูลต้นฉบับ</span><span class="sxs-lookup"><span data-stu-id="6cbc5-133">The transformations could be achieved by writing a database view that logically transforms source data.</span></span> <span data-ttu-id="6cbc5-134">หรือโดยการเตรียมการข้อมูลทางกายภาพล่วงหน้าของ Power BI จะทำการสอบถามได้</span><span class="sxs-lookup"><span data-stu-id="6cbc5-134">Or, by physically preparing and materializing data, in advance of Power BI querying it.</span></span> <span data-ttu-id="6cbc5-135">คลังข้อมูลเชิงสัมพันธ์คือตัวอย่างที่ยอดเยี่ยมของข้อมูลที่มีการจัดเตรียมไว้ใช้งาน โดยทั่วไปแล้วจะประกอบด้วยแหล่งข้อมูลขององค์กรที่รวมไว้ล่วงหน้า</span><span class="sxs-lookup"><span data-stu-id="6cbc5-135">A relational data warehouse is an excellent example of prepared data, usually consisting of pre-integrated sources of organizational data.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6cbc5-136">ขั้นตอนถัดไป</span><span class="sxs-lookup"><span data-stu-id="6cbc5-136">Next steps</span></span>

<span data-ttu-id="6cbc5-137">สำหรับข้อมูลเพิ่มเติมเกี่ยวกับบทความนี้ โปรดดูทรัพยากรต่อไปนี้:</span><span class="sxs-lookup"><span data-stu-id="6cbc5-137">For more information about this article, check out the following resources:</span></span>

- <span data-ttu-id="6cbc5-138">บทความแนวคิดของ[การพับคิวรี](/power-query/power-query-folding)ใน Power Query</span><span class="sxs-lookup"><span data-stu-id="6cbc5-138">Power Query [Query folding](/power-query/power-query-folding) concept article</span></span>
- [<span data-ttu-id="6cbc5-139">การรีเฟรชแบบเพิ่มหน่วยใน Power BI Premium</span><span class="sxs-lookup"><span data-stu-id="6cbc5-139">Incremental refresh in Power BI Premium</span></span>](../admin/service-premium-incremental-refresh.md)
- <span data-ttu-id="6cbc5-140">มีคำถามหรือไม่</span><span class="sxs-lookup"><span data-stu-id="6cbc5-140">Questions?</span></span> [<span data-ttu-id="6cbc5-141">ลองถามชุมชน Power BI</span><span class="sxs-lookup"><span data-stu-id="6cbc5-141">Try asking the Power BI Community</span></span>](https://community.powerbi.com/)
