---
title: การอ้างอิงคิวรี Power Query
description: คำแนะนำการอ้างอิงคิวรี Power Query
author: peter-myers
ms.author: v-pemyer
ms.reviewer: asaxton
ms.service: powerbi
ms.subservice: powerbi
ms.topic: conceptual
ms.date: 11/30/2019
ms.openlocfilehash: f7756c53799838182be9288f297c0d01a7c6cca3
ms.sourcegitcommit: 653e18d7041d3dd1cf7a38010372366975a98eae
ms.translationtype: HT
ms.contentlocale: th-TH
ms.lasthandoff: 12/01/2020
ms.locfileid: "96419302"
---
# <a name="referencing-power-query-queries"></a><span data-ttu-id="bda3c-103">การอ้างอิงคิวรี Power Query</span><span class="sxs-lookup"><span data-stu-id="bda3c-103">Referencing Power Query queries</span></span>

<span data-ttu-id="bda3c-104">บทความนี้มุ่งเป้าหมายไปที่เรื่อง ตัวสร้างแบบจำลองข้อมูลนำเข้าที่ทำงานกับ Power BI Desktop</span><span class="sxs-lookup"><span data-stu-id="bda3c-104">This article targets you as a data modeler working with Power BI Desktop.</span></span> <span data-ttu-id="bda3c-105">บทความนี้จะให้คำแนะนำเกี่ยวกับการนิยาม Power Query ที่ต้องอ้างอิงคิวรีอื่น</span><span class="sxs-lookup"><span data-stu-id="bda3c-105">It provides you with guidance when defining Power Query queries that reference other queries.</span></span>

<span data-ttu-id="bda3c-106">การขยายความให้ชัดเจน: _เมื่อคิวรีแรกมีการอ้างอิงถึงคิวรีที่สองนั่นหมายความว่าคิวรีที่สองจะต้องเข้ารวมกับคิวรีแรกที่กำลังทำงานอยู่_</span><span class="sxs-lookup"><span data-stu-id="bda3c-106">Let's be clear about what this means: _When a query references a second query, it's as though the steps in the second query are combined with, and run before, the steps in the first query._</span></span>

<span data-ttu-id="bda3c-107">พิจารณาหลายคิวรี: **คิวรีที่ 1** แหล่งข้อมูลจากบริการเว็บและไม่สามารถโหลดได้</span><span class="sxs-lookup"><span data-stu-id="bda3c-107">Consider several queries: **Query1** sources data from a web service, and its load is disabled.</span></span> <span data-ttu-id="bda3c-108">**คิวรีที่ 2**, **คิวรีที่ 3** และ **คิวรีที่ 4** ทั้งหมดอ้างอิงจาก **คิวรีที่ 1** และผลลัพธ์ที่โหลดไปยังรูปแบบข้อมูล</span><span class="sxs-lookup"><span data-stu-id="bda3c-108">**Query2**, **Query3**, and **Query4** all reference **Query1**, and their outputs are loaded to the data model.</span></span>

![แผนภาพที่แสดงมุมมองการขึ้นต่อกันของคิวรี โดยจะแสดงคิวรีตามที่อธิบายในย่อหน้าก่อนหน้านี้](media/power-query-referenced-queries/query-dependencies-web-service.png)

<span data-ttu-id="bda3c-110">เมื่อรีเฟรชรูปแบบข้อมูลแล้ว ระบบมักจะสันนิษฐานว่า Power Query ได้ข้อมูลมาจากผลลัพธ์ของ **คิวรี 1** และนั่นคือการนำคิวรีที่อ้างอิงแล้วกลับมาใช้งานใหม่อีกครั้ง</span><span class="sxs-lookup"><span data-stu-id="bda3c-110">When the data model is refreshed, it's often assumed that Power Query retrieves the **Query1** result, and that it's reused by referenced queries.</span></span> <span data-ttu-id="bda3c-111">วิธีคิดแบบนี้ไม่ถูกต้อง</span><span class="sxs-lookup"><span data-stu-id="bda3c-111">This thinking is incorrect.</span></span> <span data-ttu-id="bda3c-112">อันที่จริงแล้ว Power Query ให้ **คิวรี 2**, **คิวรี 3** และ **คิวรี 4** ดำเนินการแตกต่างกัน</span><span class="sxs-lookup"><span data-stu-id="bda3c-112">In fact, Power Query executes **Query2**, **Query3**, and **Query4** separately.</span></span>

<span data-ttu-id="bda3c-113">คุณสามารถพูดได้ว่า **คิวรี 2** ฝังตัวอยู่กับ **คิวรี 1** ก็ได้</span><span class="sxs-lookup"><span data-stu-id="bda3c-113">You can think that **Query2** has the **Query1** steps embedded into it.</span></span> <span data-ttu-id="bda3c-114">ยังมีกรณีสำหรับ **คิวรี 3** และ **คิวรี 4** ด้วยนะ</span><span class="sxs-lookup"><span data-stu-id="bda3c-114">It's the case for **Query3** and **Query4**, too.</span></span> <span data-ttu-id="bda3c-115">ประโยคต่อไปนี้จะแสดงให้เห็นภาพที่ชัดเจนขึ้นว่าสรุปแล้วคิวรีมีรูปแบบดำเนินการอย่างไร</span><span class="sxs-lookup"><span data-stu-id="bda3c-115">The following diagram presents a clearer picture of how the queries are executed.</span></span>

![แผนภาพที่แสดงมุมมองการขึ้นต่อกันของคิวรีในรูปแบบที่แก้ไขแล้ว โดยจะแสดงคิวรี 2, คิวรี 3 และคิวรี 4](media/power-query-referenced-queries/query-dependencies-web-service-concept.png)

<span data-ttu-id="bda3c-117">**คิวรที่ 1** จะมีการดำเนินการทั้งหมดสามครั้ง</span><span class="sxs-lookup"><span data-stu-id="bda3c-117">**Query1** is executed three times.</span></span> <span data-ttu-id="bda3c-118">การดำเนินการหลายๆ ครั้งจะส่งผลให้การรีเฟรชข้อมูลช้าลงและถ้าเลวร้ายกว่านั้นการดำเนินการนี้จะส่งผลกระทบกับแหล่งข้อมูล</span><span class="sxs-lookup"><span data-stu-id="bda3c-118">The multiple executions can result in slow data refresh, and negatively impact on the data source.</span></span>

<span data-ttu-id="bda3c-119">การใช้ฟังก์ชัน [Table.Buffer](/powerquery-m/table-buffer) ใน **คิวรีที่1** ไม่ได้ช่วยกำจัดการดึงข้อมูลเพิ่มเติมเข้ามา</span><span class="sxs-lookup"><span data-stu-id="bda3c-119">The use of the [Table.Buffer](/powerquery-m/table-buffer) function in **Query1** won't eliminate the additional data retrieval.</span></span> <span data-ttu-id="bda3c-120">ฟังก์ชันนี้เป็นตารางที่อยู่ในส่วนของการเก็บข้อมูล</span><span class="sxs-lookup"><span data-stu-id="bda3c-120">This function buffers a table to memory.</span></span> <span data-ttu-id="bda3c-121">และตารางบัฟเฟอร์สามารถใช้ในการดำเนินการคิวรีเดียวเท่านั้น</span><span class="sxs-lookup"><span data-stu-id="bda3c-121">And, the buffered table can only be used within the same query execution.</span></span> <span data-ttu-id="bda3c-122">อย่างเช่นในตัวอย่างนี้ **คิวรีที่ 1** จะบัฟเฟอร์เมื่อ **คิวรีที่ 2** มีการดำเนินการแล้วเท่านั้นการบัฟเฟอร์ข้อมูลไม่สามารถทำได้เมื่อ **คิวรีที่ 3** และ **คิวรีที่ 4** ยังคงทำงานอยู่</span><span class="sxs-lookup"><span data-stu-id="bda3c-122">So, in the example, if **Query1** is buffered when **Query2** is executed, the buffered data couldn't be used when **Query3** and **Query4** are executed.</span></span> <span data-ttu-id="bda3c-123">คิวรีเหล่านั้นจะบัฟเฟอร์ข้อมูลซ้ำมากกว่าสองครั้ง</span><span class="sxs-lookup"><span data-stu-id="bda3c-123">They'll themselves buffer the data twice more.</span></span> <span data-ttu-id="bda3c-124">(ผลลัพธ์ที่ได้อาจส่งผลร้ายต่อประสิทธิภาพการทำงานเพราะตารางจะถูกบัฟเฟอร์ตามคิวรีที่อ้างอิง)</span><span class="sxs-lookup"><span data-stu-id="bda3c-124">(This result could in fact compound the negative performance, because the table will be buffered by each referencing query.)</span></span>

> [!NOTE]
> <span data-ttu-id="bda3c-125">โครงสร้างของ Power Query เชิงลึกเป็นอะไรที่ซับซ้อนซึ่งบทความนี้ไม่ได้มีหน้าที่อธิบายเรื่องนั้น</span><span class="sxs-lookup"><span data-stu-id="bda3c-125">Power Query caching architecture is complex, and it's not the focus of this article.</span></span> <span data-ttu-id="bda3c-126">Power Query สามารถแคชดึงข้อมูลมาจากแหล่งข้อมูลได้</span><span class="sxs-lookup"><span data-stu-id="bda3c-126">Power Query can cache data retrieved from a data source.</span></span> <span data-ttu-id="bda3c-127">อย่างไรก็ตามเมื่อคิวรีเริ่มทำงานแล้ว คิวรีอาจดึงข้อมูลมาจากแหล่งข้อมูลมากกว่าหนึ่งครั้ง</span><span class="sxs-lookup"><span data-stu-id="bda3c-127">However, when it executes a query, it may retrieve the data from the data source more than once.</span></span>

## <a name="recommendations"></a><span data-ttu-id="bda3c-128">คำแนะนำ</span><span class="sxs-lookup"><span data-stu-id="bda3c-128">Recommendations</span></span>

<span data-ttu-id="bda3c-129">โดยทั่วไปแล้วเราแนะนำให้คุณอ้างอิงคิวรีเพื่อเลี่ยงการทำคิวรีซ้ำ</span><span class="sxs-lookup"><span data-stu-id="bda3c-129">Generally, we recommend you reference queries to avoid the duplication of logic across your queries.</span></span> <span data-ttu-id="bda3c-130">อย่างไรก็ตามอย่างที่ได้อธิบายไปในบทความนี้แล้ว การดำเนินการเช่นนั้นอาจทำให้การรีเฟรชข้อมูลช้าลงและทำให้แหล่งข้อมูลทำงานหนักเกินไป</span><span class="sxs-lookup"><span data-stu-id="bda3c-130">However, as described in this article, this design approach can contribute to slow data refreshes, and overburden data sources.</span></span>

<span data-ttu-id="bda3c-131">เราแนะนำให้คุณสร้าง [กระแสข้อมูล](../transform-model/dataflows/dataflows-introduction-self-service.md) แทน</span><span class="sxs-lookup"><span data-stu-id="bda3c-131">We recommend you create a [dataflow](../transform-model/dataflows/dataflows-introduction-self-service.md) instead.</span></span> <span data-ttu-id="bda3c-132">การใช้กระแสข้อมูลสามารถช่วยปรับปรุงเวลาที่รีเฟรชข้อมูลและลดผลกระทบกับแหล่งข้อมูลของคุณได้</span><span class="sxs-lookup"><span data-stu-id="bda3c-132">Using a dataflow can improve data refresh time, and reduce impact on your data sources.</span></span>

<span data-ttu-id="bda3c-133">คุณสามารถออกแบบกระแสข้อมูลเพื่อย่อส่วนแหล่งข้อมูลและแปลงข้อมูล</span><span class="sxs-lookup"><span data-stu-id="bda3c-133">You can design the dataflow to encapsulate the source data and transformations.</span></span> <span data-ttu-id="bda3c-134">เมื่อกระแสข้อมูลยังคงอยู่ที่ที่เก็บข้อมูลในบริการ Power BI การดึงข้อมูลจึงสามารถทำได้อย่างรวดเร็ว</span><span class="sxs-lookup"><span data-stu-id="bda3c-134">As the dataflow is a persisted store of data in the Power BI service, its data retrieval is fast.</span></span> <span data-ttu-id="bda3c-135">ดังนั้น แม้ว่าจะมีการรอขอคิวรีอ้างอิงข้อมูลในกระแสข้อมูลหลายครั้ง เวลาในการรีเฟรชข้อมูลสามารถทำให้เร็วขึ้นได้</span><span class="sxs-lookup"><span data-stu-id="bda3c-135">So, even when referencing queries result in multiple requests for the dataflow, data refresh times can be improved.</span></span>

<span data-ttu-id="bda3c-136">ยกตัวอย่างเช่นถ้า  **คิวรี 1** ถูกออกแบบให้เป็นเอ็นทิตี้กระแสข้อมูลใหม่ใน **คิวรี 2**, **คิวรี 3**, และ **คิวรี 4** ก็จะยังสามารถใช้เป็นแหล่งข้อมูลได้</span><span class="sxs-lookup"><span data-stu-id="bda3c-136">In the example, if **Query1** is redesigned as a dataflow entity, **Query2**, **Query3**, and **Query4** can use it as a data source.</span></span> <span data-ttu-id="bda3c-137">ด้วยการออกแบบนี้ แหล่งข้อมูลเอ็นทิตี้จาก **คิวรี 1** จะถูกประเมินภายในครั้งเดียว</span><span class="sxs-lookup"><span data-stu-id="bda3c-137">With this design, the entity sourced by **Query1** will be evaluated only once.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bda3c-138">ขั้นตอนถัดไป</span><span class="sxs-lookup"><span data-stu-id="bda3c-138">Next steps</span></span>

<span data-ttu-id="bda3c-139">สำหรับข้อมูลเพิ่มเติมที่เกี่ยวข้องกับบทความนี้ โปรดดูทรัพยากรต่อไปนี้:</span><span class="sxs-lookup"><span data-stu-id="bda3c-139">For more information related to this article, check out the following resources:</span></span>

- [<span data-ttu-id="bda3c-140">การเตรียมข้อมูลด้วยตนเองใน Power BI</span><span class="sxs-lookup"><span data-stu-id="bda3c-140">Self-service data prep in Power BI</span></span>](../transform-model/dataflows/dataflows-introduction-self-service.md)
- [<span data-ttu-id="bda3c-141">การสร้างและการใช้กระแสข้อมูลใน Power BI</span><span class="sxs-lookup"><span data-stu-id="bda3c-141">Creating and using dataflows in Power BI</span></span>](../transform-model/dataflows/dataflows-create.md)
- <span data-ttu-id="bda3c-142">มีคำถามหรือไม่</span><span class="sxs-lookup"><span data-stu-id="bda3c-142">Questions?</span></span> [<span data-ttu-id="bda3c-143">ลองถามชุมชน Power BI</span><span class="sxs-lookup"><span data-stu-id="bda3c-143">Try asking the Power BI Community</span></span>](https://community.powerbi.com/)
- <span data-ttu-id="bda3c-144">มีข้อเสนอแนะไหม</span><span class="sxs-lookup"><span data-stu-id="bda3c-144">Suggestions?</span></span> [<span data-ttu-id="bda3c-145">สนับสนุนแนวคิดในการปรับปรุง Power BI</span><span class="sxs-lookup"><span data-stu-id="bda3c-145">Contribute ideas to improve Power BI</span></span>](https://ideas.powerbi.com/)